

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Running easyQuake &mdash; easyQuake 1.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=92fd9be5" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=292eb321"></script>
      <script src="_static/doctools.js?v=9a2dae69"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Function Reference" href="Additional.html" />
    <link rel="prev" title="About" href="About.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            easyQuake
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="About.html">About</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Running easyQuake</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#event-mode">Event mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="#core-modules">Core modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#data-download">Data Download</a></li>
<li class="toctree-l3"><a class="reference internal" href="#earthquake-detection">Earthquake Detection</a></li>
<li class="toctree-l3"><a class="reference internal" href="#event-association">Event Association</a></li>
<li class="toctree-l3"><a class="reference internal" href="#earthquake-magnitude">Earthquake Magnitude</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#additional-modules">Additional Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#hypoinverse">Hypoinverse</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interface-with-seiscomp">Interface with Seiscomp</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hypodd-or-growclust-relative-relocation">HypoDD or Growclust relative relocation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">HypoDD or Growclust relative relocation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#tips-for-success">Tips for Success</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Additional.html">Function Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">easyQuake</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Running easyQuake</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Getting_Started.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="running-easyquake">
<span id="getting-started"></span><h1>Running easyQuake<a class="headerlink" href="#running-easyquake" title="Link to this heading"></a></h1>
<section id="event-mode">
<span id="id1"></span><h2>Event mode<a class="headerlink" href="#event-mode" title="Link to this heading"></a></h2>
<p>Check that everything is installed and working as it should by detecting a single Oklahoma event on a snippet of downloaded miniseed data from the OGS network:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">easyQuake</span> <span class="kn">import</span> <span class="n">detection_association_event</span>
<span class="n">detection_association_event</span><span class="p">(</span><span class="n">project_folder</span><span class="o">=</span><span class="s1">&#39;/scratch&#39;</span><span class="p">,</span> <span class="n">project_code</span><span class="o">=</span><span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="n">maxdist</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">maxkm</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">machine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="mf">36.7</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=-</span><span class="mf">98.4</span><span class="p">,</span> <span class="n">max_radius</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">approxorigintime</span><span class="o">=</span><span class="s1">&#39;2021-01-27T14:03:46&#39;</span><span class="p">,</span> <span class="n">downloadwaveforms</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>A few things are going on here. You are downloading waveforms, detecting picks with the GPD picker, associating events to get an approximate location, and then approximating an event magnitude from the amplitudes of the horizontal seismograph components (i.e. Richter magnitude). These are steps that you would normally separate into 4, but they are all in one here.</p>
<p>We can set various parameters here. In this case, we choose an approximate location for the data downloader (<em>lat</em> and <em>long</em>) and a maximum radius (<em>max_radius</em>) over which to download data from stations. Next we set <em>maxdist</em> and <em>maxkm</em>, the variables that control the maximum distance from a station to a possible hypocenter (based on detected S-P times) and the maximum distance over which to precompute the travel-times for the 1D traveltime lookup tables. The variables <em>local</em> and <em>machine</em> set whether the station metadata (or inventory file) should be within the day folder (it will be since we are downloading the waveforms) and whether the picker is the machine-learning picker. If everything runs at it should, it should create an event file ending with <em>.xml</em>, which is a QuakeML-formatted event file. You can inspect this with a text editor or open it with obspy with the <em>read_events</em> module.</p>
</section>
<section id="core-modules">
<h2>Core modules<a class="headerlink" href="#core-modules" title="Link to this heading"></a></h2>
<section id="data-download">
<h3>Data Download<a class="headerlink" href="#data-download" title="Link to this heading"></a></h3>
<p>In reality, we don’t really want to do earthquake detection based on a general idea of the time and location of an event. We want to determine events from continuous seismograms.</p>
<p>The easyQuake package can download waveforms for you and will organize the downloaded waveforms in a uniform manner so that it can run the subsequent submodules on the dataset. It leverages the obspy mass_downloader, with a few tweaks, so that by selecting a latitude and longitude bounding box, you will end up with folders in your working directory organized by year, day, and then month (YYYYDDMM).</p>
<p>Within each folder, the daylong miniseed files will be there, as well as the stationXML inventory metadata files. If you choose to work with a local dataset, it is easiest if you work with the same folder structure for your data.</p>
<p>As a tutorial example, let’s gather data adjacent to the March 31, 2020 M6.5 Central Idaho earthquake:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">easyQuake</span> <span class="kn">import</span> <span class="n">download_mseed</span>
<span class="kn">from</span> <span class="nn">easyQuake</span> <span class="kn">import</span> <span class="n">daterange</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="n">lat_a</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">lat_b</span> <span class="o">=</span> <span class="mf">47.5</span>
<span class="n">lon_a</span> <span class="o">=</span> <span class="o">-</span><span class="mi">118</span>
<span class="n">lon_b</span> <span class="o">=</span> <span class="o">-</span><span class="mi">111</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">project_code</span> <span class="o">=</span> <span class="s1">&#39;idaho&#39;</span>
<span class="n">project_folder</span> <span class="o">=</span> <span class="s1">&#39;/data/id&#39;</span>
<span class="k">for</span> <span class="n">single_date</span> <span class="ow">in</span> <span class="n">daterange</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
    <span class="n">dirname</span> <span class="o">=</span> <span class="n">single_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">download_mseed</span><span class="p">(</span><span class="n">dirname</span><span class="o">=</span><span class="n">dirname</span><span class="p">,</span> <span class="n">project_folder</span><span class="o">=</span><span class="n">project_folder</span><span class="p">,</span> <span class="n">single_date</span><span class="o">=</span><span class="n">single_date</span><span class="p">,</span> <span class="n">minlat</span><span class="o">=</span><span class="n">lat_a</span><span class="p">,</span> <span class="n">maxlat</span><span class="o">=</span><span class="n">lat_b</span><span class="p">,</span> <span class="n">minlon</span><span class="o">=</span><span class="n">lon_a</span><span class="p">,</span> <span class="n">maxlon</span><span class="o">=</span><span class="n">lon_b</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="earthquake-detection">
<h3>Earthquake Detection<a class="headerlink" href="#earthquake-detection" title="Link to this heading"></a></h3>
<p>Earthquake detection leverages either one of two machine-learning pickers: GPD (Ross et al., 2018) or EQTransformer (Mousavi et al., 2020). The earthquake detection module is simply a one-liner after data has been downloaded or otherwise organized, as described above. To continue with the tutorial exercise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">easyQuake</span> <span class="kn">import</span> <span class="n">detection_continuous</span>
<span class="kn">from</span> <span class="nn">easyQuake</span> <span class="kn">import</span> <span class="n">daterange</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">project_code</span> <span class="o">=</span> <span class="s1">&#39;idaho&#39;</span>
<span class="n">project_folder</span> <span class="o">=</span> <span class="s1">&#39;/data/id&#39;</span>
<span class="k">for</span> <span class="n">single_date</span> <span class="ow">in</span> <span class="n">daterange</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
    <span class="n">dirname</span> <span class="o">=</span> <span class="n">single_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">detection_continuous</span><span class="p">(</span><span class="n">dirname</span><span class="o">=</span><span class="n">dirname</span><span class="p">,</span> <span class="n">project_folder</span><span class="o">=</span><span class="n">project_folder</span><span class="p">,</span> <span class="n">project_code</span><span class="o">=</span><span class="n">project_code</span><span class="p">,</span> <span class="n">single_date</span><span class="o">=</span><span class="n">single_date</span><span class="p">,</span> <span class="n">machine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># run it with EQTransformer instead of GPD picker</span>
    <span class="c1">#detection_continuous(dirname=dirname, project_folder=project_folder, project_code=project_code, machine=True, machine_picker=&#39;EQTransformer&#39;, local=True, single_date=single_date)</span>
</pre></div>
</div>
<p>It should be becoming apparent that the easyQuake submodules only work on a given day of data. Thus, the user needs to consider strategies by which several days of data can be analyzed in the loop with the daterange function. As you can see from the above code snippet, it runs the detection on each day of data and the detection is done in serial. Each day can only run at one time for a single workstation. This is due to the limited GPU resources available to us (one or two GPUs on a single workstation) - the machine learning pickers will automatically allocate all the GPU memory it can find so you cannot run detection in parallel - it would lead to errors that are difficult to track.</p>
<p>In the above code snippet, you can see uncomment the EQTransformer line and compare your detection results between GPD and EQTransformer pickers.</p>
<p>During this stage, you should see your video card working on the dataset. Run it in ipython and you can check that it is running correctly in a different terminal window by checking that video memory is being used by python with the “nvidia-smi” terminal command.</p>
</section>
<section id="event-association">
<h3>Event Association<a class="headerlink" href="#event-association" title="Link to this heading"></a></h3>
<p>For event association, we modified the PhasePApy package (Chen and Holland, 2016) to work within the easyQuake data structure and outputs from the picker. Either ML picker generates a file called gpd_picks.out that is simply a list of plausible detected events, time of detection, and station name. Another way to check that the pickers are working is whether there is data in the gpd_picks.out file. In the previous step, those detections are added to an sqlite file called 1dassociator.db, which should be within each day folder where detection has been completed. As above, the association can be completed on the example tutorial dataset:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">easyQuake</span> <span class="kn">import</span> <span class="n">association_continuous</span>
<span class="kn">from</span> <span class="nn">easyQuake</span> <span class="kn">import</span> <span class="n">daterange</span>
<span class="kn">from</span> <span class="nn">easyQuake</span> <span class="kn">import</span> <span class="n">combine_associated</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">maxdist</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">maxkm</span> <span class="o">=</span> <span class="mi">300</span>

<span class="n">project_code</span> <span class="o">=</span> <span class="s1">&#39;idaho&#39;</span>
<span class="n">project_folder</span> <span class="o">=</span> <span class="s1">&#39;/data/id&#39;</span>
<span class="k">for</span> <span class="n">single_date</span> <span class="ow">in</span> <span class="n">daterange</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
    <span class="n">dirname</span> <span class="o">=</span> <span class="n">single_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">association_continuous</span><span class="p">(</span><span class="n">dirname</span><span class="o">=</span><span class="n">dirname</span><span class="p">,</span> <span class="n">project_folder</span><span class="o">=</span><span class="n">project_folder</span><span class="p">,</span> <span class="n">project_code</span><span class="o">=</span><span class="n">project_code</span><span class="p">,</span> <span class="n">maxdist</span><span class="o">=</span><span class="n">maxdist</span><span class="p">,</span> <span class="n">maxkm</span><span class="o">=</span><span class="n">maxkm</span><span class="p">,</span> <span class="n">single_date</span><span class="o">=</span><span class="n">single_date</span><span class="p">,</span> <span class="n">local</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cat</span><span class="p">,</span> <span class="n">dfs</span> <span class="o">=</span> <span class="n">combine_associated</span><span class="p">(</span><span class="n">project_folder</span><span class="o">=</span><span class="n">project_folder</span><span class="p">,</span> <span class="n">project_code</span><span class="o">=</span><span class="n">project_code</span><span class="p">)</span>
</pre></div>
</div>
<p>This script runs the association step, in serial, within each day folder. Obviously, for a large amount of data, this would take quite a long time but is fine for the example tutorial. For longer datasets it would be better to utilize the Python multiprocessing package. As an example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">easyQuake</span> <span class="kn">import</span> <span class="n">association_continuous</span>
<span class="kn">from</span> <span class="nn">easyQuake</span> <span class="kn">import</span> <span class="n">daterange</span>
<span class="kn">from</span> <span class="nn">easyQuake</span> <span class="kn">import</span> <span class="n">combine_associated</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">maxdist</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">maxkm</span> <span class="o">=</span> <span class="mi">300</span>

<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span>
<span class="n">pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">project_code</span> <span class="o">=</span> <span class="s1">&#39;idaho&#39;</span>
<span class="n">project_folder</span> <span class="o">=</span> <span class="s1">&#39;/data/id&#39;</span>
<span class="k">for</span> <span class="n">single_date</span> <span class="ow">in</span> <span class="n">daterange</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
    <span class="n">dirname</span> <span class="o">=</span> <span class="n">single_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">pool</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">association_continuous</span><span class="p">,</span> <span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">project_folder</span><span class="p">,</span> <span class="n">project_code</span><span class="p">,</span> <span class="n">maxdist</span><span class="p">,</span> <span class="n">maxkm</span><span class="p">,</span> <span class="n">single_date</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">pool</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="n">cat</span><span class="p">,</span> <span class="n">dfs</span> <span class="o">=</span> <span class="n">combine_associated</span><span class="p">(</span><span class="n">project_folder</span><span class="o">=</span><span class="n">project_folder</span><span class="p">,</span> <span class="n">project_code</span><span class="o">=</span><span class="n">project_code</span><span class="p">)</span>
</pre></div>
</div>
<p>The final line in the association example combine all the day folder possible events and saves a <em>idaho_cat.xml</em> Obsby-compatible Catalog file in the <em>project_folder</em>. This file is also QuakeML compatible and includes pick and origin info. The catalog will be built out in subsequent post-processing steps (below).</p>
</section>
<section id="earthquake-magnitude">
<h3>Earthquake Magnitude<a class="headerlink" href="#earthquake-magnitude" title="Link to this heading"></a></h3>
<p>Finally, we estimate earthquake magnitudes and the submodule <em>magnitude_quakeml</em> includes the amplitude and station magnitudes in the Catalog file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">easyQuake</span> <span class="kn">import</span> <span class="n">magnitude_quakeml</span>
<span class="kn">from</span> <span class="nn">easyQuake</span> <span class="kn">import</span> <span class="n">simple_cat_df</span>
<span class="kn">from</span> <span class="nn">obspy</span> <span class="kn">import</span> <span class="n">read_events</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">cat</span> <span class="o">=</span> <span class="n">read_events</span><span class="p">(</span><span class="s1">&#39;idaho_cat.xml&#39;</span><span class="p">)</span>
<span class="n">cat</span> <span class="o">=</span> <span class="n">magnitude_quakeml</span><span class="p">(</span><span class="n">cat</span><span class="o">=</span><span class="n">cat</span><span class="p">,</span> <span class="n">project_folder</span><span class="o">=</span><span class="n">project_folder</span><span class="p">,</span><span class="n">plot_event</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cat</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;catalog_idaho.xml&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;QUAKEML&#39;</span><span class="p">)</span>

<span class="c1">#test to see whether it was a success</span>
<span class="n">catdf</span> <span class="o">=</span> <span class="n">simple_cat_df</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">catdf</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">catdf</span><span class="o">.</span><span class="n">magnitude</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="additional-modules">
<h2>Additional Modules<a class="headerlink" href="#additional-modules" title="Link to this heading"></a></h2>
<p>In addition to the core modules, we have written various submodules to extend easyQuake/</p>
<section id="hypoinverse">
<h3>Hypoinverse<a class="headerlink" href="#hypoinverse" title="Link to this heading"></a></h3>
<p>Assuming that the user’s computer has hypoinverse installed (<em>hyp2000</em> as it is compiled on most systems) and it resides in the user’s path, you can drive hypoinverse with easyQuake. The steps above give a location at 5 km depth during association, which can be quite different than the absolute location:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">easyQuake</span> <span class="kn">import</span> <span class="n">locate_hyp2000</span>
<span class="n">cat</span> <span class="o">=</span> <span class="n">locate_hyp2000</span><span class="p">(</span><span class="n">cat</span><span class="o">=</span><span class="n">cat</span><span class="p">,</span> <span class="n">project_folder</span><span class="o">=</span><span class="n">project_folder</span><span class="p">)</span>
<span class="n">cat</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;catalog_idaho_hyp.xml&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;QUAKEML&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If you examine the Catalog object, you can see that there are more than one origin for most events:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">cat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">origins</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="interface-with-seiscomp">
<h3>Interface with Seiscomp<a class="headerlink" href="#interface-with-seiscomp" title="Link to this heading"></a></h3>
<p>At OGS, our analysts review ML-derived events and re-adjust picks, etc. The easyQuake events can be easily passed to a Seiscomp system. For this example, Machine #1 can be the computer that runs easyQuake, while Machine #2 will be the Seiscomp production system. First, on Machine #1:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#export to SC3ML file rather than QuakeML</span>
<span class="kn">from</span> <span class="nn">easyQuake</span> <span class="kn">import</span> <span class="n">single_event_xml</span>
<span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;SC3ML&quot;</span>
<span class="c1">#remove the previous zip file</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;rm -r /scratch/scratch/&#39;</span><span class="o">+</span><span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
<span class="n">single_event_xml</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span><span class="s1">&#39;/scratch/scratch&#39;</span><span class="p">,</span><span class="nb">format</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">make_archive</span><span class="p">(</span><span class="s1">&#39;/scratch/scratch/sc3ml&#39;</span><span class="p">,</span> <span class="s1">&#39;zip&#39;</span><span class="p">,</span> <span class="s1">&#39;/scratch/scratch/&#39;</span><span class="p">,</span> <span class="s1">&#39;/scratch/scratch/sc3ml&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;scp /scratch/scratch/sc3ml.zip /machine2/directory/ml/&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then on Machine #2, we have a listener written in bash that waits for file ingestion and strips away the event info so that it can be added to the event queue for review:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#!/bin/bash
/usr/local/bin/inotifywait -m /home/sysop/incoming_ML -e create -e moved_to |
while read directory action file; do
        if [[ &quot;$file&quot; =~ .*xml$ ]]; then # Does the file end with .xml?
                scdispatch -i /home/sysop/incoming_ML/$file -O add --routingtable Pick:PICK,Amplitude:AMPLITUDE,Origin:LOCATION,StationMagnitude:MAGNITUDE,Magnitude:MAGNITUDE
                rm /home/sysop/incoming_ML/$file
        fi
done
</pre></div>
</div>
</section>
<section id="hypodd-or-growclust-relative-relocation">
<h3>HypoDD or Growclust relative relocation<a class="headerlink" href="#hypodd-or-growclust-relative-relocation" title="Link to this heading"></a></h3>
<p>Oftentimes, ML pickers also are not 100% accurate and we want to determine relative locations through the use of HypoDD or Growclust:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">jakewalter</span><span class="o">/</span><span class="n">hypoDDpy</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">hypoDDpy</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">.</span>
</pre></div>
</div>
<p>Once this is installed, you can run it and generate the cross-correlations in the way in which it is described in hypoDDpy below. Note that you should run the easyQuake function fix_picks_catalog before to make sure that the components are correct (easyQuake does not usually correctly have the accurate</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">easyQuake</span> <span class="kn">import</span> <span class="n">fix_picks_catalog</span>
<span class="n">cat2</span> <span class="o">=</span> <span class="n">fix_picks_catalog</span><span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">project_folder</span><span class="p">)</span>
<span class="n">cat2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;catalog_fixed.xml&#39;</span><span class="p">,</span><span class="s1">&#39;QUAKEML&#39;</span><span class="p">)</span>
<span class="n">relocator</span> <span class="o">=</span> <span class="n">HypoDDRelocator</span><span class="p">(</span><span class="n">working_dir</span><span class="o">=</span><span class="s2">&quot;relocate1&quot;</span><span class="p">,</span>
    <span class="n">cc_time_before</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="n">cc_time_after</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">cc_maxlag</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
    <span class="n">cc_filter_min_freq</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
    <span class="n">cc_filter_max_freq</span><span class="o">=</span><span class="mf">14.0</span><span class="p">,</span>
    <span class="n">cc_p_phase_weighting</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Z&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
    <span class="n">cc_s_phase_weighting</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
    <span class="n">cc_min_allowed_cross_corr_coeff</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="c1"># Add the necessary files. Call a function multiple times if necessary.</span>
<span class="n">relocator</span><span class="o">.</span><span class="n">add_event_files</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;/data/proj_dir/catalog_fixed.xml&quot;</span><span class="p">))</span>
<span class="n">relocator</span><span class="o">.</span><span class="n">add_waveform_files</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;/data/proj_dir/20*/*mseed&quot;</span><span class="p">))</span>
<span class="n">relocator</span><span class="o">.</span><span class="n">add_station_files</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;/data/proj_dir/20*/*.xml&quot;</span><span class="p">))</span>

<span class="c1"># Setup the velocity model. This is just a constant velocity model.</span>
<span class="n">relocator</span><span class="o">.</span><span class="n">setup_velocity_model</span><span class="p">(</span>
    <span class="n">model_type</span><span class="o">=</span><span class="s2">&quot;layered_p_velocity_with_constant_vp_vs_ratio&quot;</span><span class="p">,</span>
    <span class="n">layer_tops</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.7</span><span class="p">),(</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">2.95</span><span class="p">),(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">4.15</span><span class="p">),(</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">5.8</span><span class="p">),(</span><span class="mi">21</span><span class="p">,</span><span class="mf">6.3</span><span class="p">)],</span>
    <span class="n">vp_vs_ratio</span><span class="o">=</span><span class="mf">1.73</span><span class="p">)</span>

<span class="c1"># Start the relocation with the desired output file.</span>
<span class="n">relocator</span><span class="o">.</span><span class="n">start_relocation</span><span class="p">(</span><span class="n">output_event_file</span><span class="o">=</span><span class="s2">&quot;relocated_events.xml&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can use the easyQuake utility:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">easyQuake</span> <span class="kn">import</span> <span class="n">quakeml_to_growclust</span>
<span class="n">quakeml_to_growclust</span><span class="p">(</span><span class="n">project_folder</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="id2">
<h3>HypoDD or Growclust relative relocation<a class="headerlink" href="#id2" title="Link to this heading"></a></h3>
<p>Focal mechanisms:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">jakewalter</span><span class="o">/</span><span class="n">hashpy</span><span class="o">.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">hashpy</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">.</span>
</pre></div>
</div>
</section>
</section>
<section id="tips-for-success">
<h2>Tips for Success<a class="headerlink" href="#tips-for-success" title="Link to this heading"></a></h2>
<p>Most of the time it is beneficial to run jobs overnight and in the background (or several days for longer datasets):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">nohup</span> <span class="n">python</span> <span class="n">yourscript</span><span class="o">.</span><span class="n">py</span> <span class="o">&amp;</span>
</pre></div>
</div>
<p>If something goes wrong, you can inspect the nohup.out file (or just the end of it):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">tail</span> <span class="o">-</span><span class="n">n</span> <span class="mi">100</span> <span class="n">nohup</span><span class="o">.</span><span class="n">out</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="About.html" class="btn btn-neutral float-left" title="About" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Additional.html" class="btn btn-neutral float-right" title="Function Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>